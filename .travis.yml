sudo: required
language: none

services:
  - docker

matrix:
  include:
    #- env: CI_TARGET=debug

    - env: CI_TARGET=release
      after_success:
        - cd $TRAVIS_BUILD_DIR/build-release/doc
        - ls -la .
        - touch html/.nojekyll
        - mv tags.xml html/tags.xml
      deploy:
        provider: pages
        skip_cleanup: true
        github_token: $GITHUB_TOKEN
        local_dir: $TRAVIS_BUILD_DIR/build-release/doc/html
        on:
          branch: doxygen-generate-tagfile

          #- env: CI_TARGET=coverage
          #after_success: bash <(curl -s https://codecov.io/bash) -g "*/test/*"

          #- env: CI_TARGET=lint

before_install:
  - sudo apt-get update

install:
  - sudo apt-get install -y bash curl

before_script:
  - docker build -t worker $TRAVIS_BUILD_DIR/.ci

script:
  - docker run -w /workspace -v $TRAVIS_BUILD_DIR:/workspace worker .ci/$CI_TARGET.sh
